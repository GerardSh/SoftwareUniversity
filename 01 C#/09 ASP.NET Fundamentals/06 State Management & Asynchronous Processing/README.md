# General
## HTTP Cookies
Малък файл с обикновен текст без изпълним код.
- Изпратен от сървъра до браузъра на клиента.
- Съхраняван от браузъра на устройството на клиента (компютър, таблет и т.н.). Това е едно от малкото неща, които можем да запишем с цел осигуряване на сигурността на потребителската машина.
- Съдържа малко количество данни за конкретен клиент и уебсайт.

Сървърът създава кукита, които изпраща към браузъра, а той ги връща обратно на всеки следващ рекуест. Вътре в кукито има двойки ключ-стойност (key-value pairs).

Според GDPR и директивата ePrivacy, трябва да уведомяваме потребителите, че използваме кукита, и да получаваме тяхното съгласие, преди да ги събираме. Това обикновено става чрез банер, който информира потребителите и им позволява да управляват предпочитанията си за кукитата. Като се съгласим да ползваме куки, дори тази информация се записва в куки.

Принципно има ограничение в размера на кукитата, но съвременните браузъри решават проблема, като ги разпадат на повече части. Така можем да съберем много голяма информация в кукитата, но не е желателно, тъй като това увеличава размера на рекуеста.

Реално информацията в кукито са неща, които сървъра трябва да помни за нас. Понеже HTTP протокола е stateless - не помни нищо. Каквото и да е имало в даден рекуест, то е загубено в следващия. След първия рекуест, на следващия сървъра вече не помни нищо за нас. Кукито се явява като work around, като в него записваме нещата, които искаме да бъдат запомнени за нас.
### Usage
1. Управление на сесии - това е най-честата употреба на кукита, като също се използват за колички за пазаруване, резултати от игри или всичко друго, което сървърът трябва да запомни.  Те могат да съхраняват информация за самия потребител, като кой е логнат, заедно с неговите допълнителни свойства. В тях се намират така наречените клейма (claims), като напоследък **claim-based identity** се използва от всички, включително и от ASP.NET. Когато се логваме някъде, някой проверява дали имаме право да се идентифицираме, като първо се проверява даден критерий, като потребителско име и парола. След като се установи, че сме ние, се проверява дали има допълнителна информация, например имейл, имена, роля и друга информация. Понеже вече сме идентифицирани и се знае кои сме, системата може да твърди, че ние сме този човек и имаме съответната информация. Въпросният провайдър, независимо кой е той, издава клеймата (claims) — твърдения за нас. Например: първо твърдение — това е името на човека, второ твърдение — той е администратор и т.н. Провайдърът записва тези твърдения в кукито и оттук нататък, всеки път, когато това куки се върне към сървъра, той ще знае тези твърдения. Няма нужда да ги проверява, защото има вяра в провайдъра и неговите твърдения. Всички тези твърдения се приемат за верни, докато кукито е валидно. В момента, в който изтече или бъде анулирано (например при **sign out**), сървърът забравя тези данни, защото не ги съхранява на друго място.

2. Персонализация - потребителски предпочитания, теми и други персонализирани настройки.

3. Проследяване - записване и анализиране на потребителско поведение. Може да се записва информация за самата активност в браузъра, като например колко хора са посетили дадена страница и колко време са се задържали на нея. Тази информация ни дава възможност да преценим кое е интересно за клиентите и кое не се посещава, като така можем да оптимизираме съдържанието и функционалността на сайта.

4. Да пазим информация, която преди това е била въведена във форма, е една от основните функции на кукитата и сесиите. Когато потребителят попълни форма и я изпрати, сървърът може да запише определена част от информацията (например потребителски имена, настройки или предпочитания) в кукита или сесийни данни, за да я запази и да я използва в бъдеще, без да се налага потребителят да въвежда отново същите данни.
### Stateless HTTP - The Problem
Сървърът не знае дали два рекуеста идват от един и същ клиент, което води до проблеми:

За всяка операция, която искаме да извършим на даден сайт, трябва да се автентикираме отново.

Друга необходима информация като количка с покупки, запазени резултати от игри, или вече сме избрали нещо на страницата, при следващия рекуест то изчезва и тн.

Няма как да се персонализира страницата.
### Stateless HTTP - The Cookie Solution
Въпреки че HTTP протоколът е **stateless**, той има механизъм за запомняне, наречен **cookie**. Чрез кукито сървърът може да помни състоянието между рекуестите. Например, когато се логнем с даден рекуест и сървърът ни върне отговор, той може да ни изпрати куки, в което е записано кой сме. В следващия рекуест, когато върнем кукито към сървъра, той вече знае кой се обръща към него, като чете информацията в кукито.

Куки и сесии често се комбинират, защото може да имаме куки, което съдържа само идентификатор на сесия. Сървърът знае откъде да извлече тази сесия, която обикновено се пази на сървъра. Важно е обаче **къде** точно се съхранява тази информация, защото това определя сигурността и достъпността на сесийните данни.
### How Are Cookies Used
Отговорът на сървъра съдържа куки, което бива запазено, чрез **Set-Cookie** header:

```
HTTP/1.1 200 OK
Set-Cookie: lang=en
```

Заявката от клиента съдържа съответното куки, което изпраща към сървъра, чрез **Cookie** header-a, ако е направена към същия domain:

```
GET www.example.bg HTTP/1.1
Cookie: lang=en
```

Това означава, че при всяко следващо посещение на същия сайт, браузърът изпраща кукито обратно към сървъра, за да може той да запомни предишните настройки, като например избран език (в случая `lang=en`).

Така, сървърът изпраща информация за куки, което браузърът запазва, а при следващите рекуести браузърът връща тези кукита обратно към сървъра.

Когато браузърът получи куки от даден сайт, той ги запазва локално. При всяко следващо искане към този същия домейн, браузърът автоматично включва съответните кукита в **Cookie** header-а на заявката. Това позволява на сървъра да "помни" информация като идентификация на потребителя или настройки. Това гарантира, че само правилните кукита ще бъдат изпращани на сървъра за съответния домейн.
### Cookie Structure
Кукито се състои от **Name**, **Value** и **Attributes** (по избор).

Атрибутите са **ключ-стойност** двойки с допълнителна информация.

Атрибутите не се включват в заявките.

Атрибутите се използват от клиента за управление на кукитата - да кажем на клиента, какво трябва да направи с даденото куки.

Пример за Set-Cookie header:

```
Set-Cookie: SSID=Ap4P…GTEq; Domain=foo.com; Path=/;
Expires=Wed, 13 Jan 2021 22:23:01 GMT; Secure; HttpOnly
```

Обяснение на атрибутите:

- **`SSID=Ap4P…GTEq`**: Това е информацията, която ще се препраща към всеки рекуест.

- **Domain=foo.com**: Кукито ще бъде изпратено само на домейна **foo.com**.

- **Path=/**: Кукито ще бъде изпратено за всички пътища на домейна.

- **Expires**: Определя кога кукито ще изтече. Ако не е зададено, кукито ще изтече при затваряне на браузъра.

- **Secure**: Кукито ще бъде изпратено само по сигурни (HTTPS) връзки.

- **`HttpOnly`**: Кукито не може да бъде достъпно чрез JavaScript, като се защитава от XSS атаки.
# Misc
# ChatGPT
# Bookmarks
Completion: 29.04.2025